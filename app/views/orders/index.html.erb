<%= form_tag "/orders", method: "get" do %>
    <div class="row" style="margin-bottom: 10px;">
      <div class="col-lg-2">
        <div class="input-group">
          <%= search_field_tag "like", nil, class: "form-control" %>
          <span class="input-group-btn">
            <%= submit_tag "查询", class: "btn btn-default" %>
          </span>
        </div>
      </div>
    </div>
<% end %>

<table id="orders"
       data-toggle="table"
       data-detail-view="true"
       data-detail-formatter="detailFormatter"
       data-minimum-count-columns="2"
       data-id-field="id">
  <thead>
    <tr>
      <th>ID</th>
      <th>客户姓名</th>
      <th>联系电话</th>
      <th>客户地址</th>
      <th>安装时间</th>
      <!--<th class="single line">安装工</th>-->
      <th>备注</th>
      <th>销售单位</th>
      <th>商品型号</th>
      <th>销售单号</th>
    </tr>
  </thead>

  <tbody>
    <% @orders.each do |order| %>
      <tr>
        <td><%= order.id %></td>
        <td>
          <a href="#" data-name="customer" data-type="text" data-pk="<%= order.id %>"
             data-url="/orders/<%= order.id.to_s + ".json" %>" data-value="<%= order.customer %>"
             class="customer-click"><%= order.customer %>
          </a>
        </td>
        <td>
          <a href="#" data-name="phone" data-type="text" data-pk="<%= order.id %>"
             data-url="/orders/<%= order.id.to_s + ".json" %>" data-value="<%= order.phone %>"
             class="phone-click"><%= order.phone %>
          </a>
        </td>
        <td>
          <a href="#" data-name="address" data-type="textarea" data-pk="<%= order.id %>"
             data-url="/orders/<%= order.id.to_s + ".json" %>" data-value="<%= order.address %>"
             class="address-click"><%= order.address %>
          </a>
        </td>
        <td>
          <a href="#" data-name="install_date" data-type="date" data-pk="<%= order.id %>"
             data-url="/orders/<%= order.id.to_s + ".json" %>" data-value="<%= order.install_date %>"
             class="install_date-click"><%= order.install_date %>
          </a>
        </td>
        <!--<td><%#= order.team_name %></td>-->
        <td>
          <a href="#" data-name="note" data-type="textarea" data-pk="<%= order.id %>"
             data-url="/orders/<%= order.id.to_s + ".json" %>" data-value="<%= order.note %>"
             class="note-click"><%= order.note %>
          </a>
        </td>
        <td><%= order.sale_name %></td>
        <td><%= order.item_type %></td>
        <td><%= order.lading_no %></td>
      </tr>
    <% end %>
  </tbody>
  <tfoot>
    <tr>
      <th colspan="10">
        <div class="">
          <%= paginate @orders %>
        </div>
      </th>
    </tr>
  </tfoot>
</table>


<script>
    $(function () {
//        $.fn.bootstrapTable.defaults;

        $("#orders").on('click-row.bs.table', function (e, row, $element) {
            $('.success').removeClass('success');
            $($element).addClass('success');
        });

        $.fn.editable.defaults.ajaxOptions = {type: "PUT", headers: { 'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content') }};
        $('.customer-click').editable();
        $('.phone-click').editable();
        $('.address-click').editable({mode: "inline"});
        $('.install_date-click').editable({
            placement:'left',
            clear: false,
            format: 'yyyy/mm/dd',
            viewformat: 'yyyy-mm-dd'
        });
        $('.note-click').editable({mode: "inline"});

        function detailFormatter(index, row) {
            var html = [];
            $.each(row, function (key, value) {
                console.log(key);
                html.push('<p><b>' + key + ':</b> ' + value + '</p>');
            });
            return html.join('');
        }
    });
</script>